apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: production

resources:
- ../../base
- secrets.yaml

nameSuffix: ""

labels:
- pairs:
    environment: production

configMapGenerator:
- name: app-config
  literals:
  - APP_ENV=production
  - LOG_LEVEL=info
  - DATABASE_HOST=postgres-production.svc.cluster.local

# ⚠️ IMPORTANTE: Os secrets devem ser gerenciados externamente por segurança
# Veja secrets.yaml.example para um modelo
# Para usar: copie secrets.yaml.example para secrets.yaml e ajuste os valores
# Considere usar ferramentas como Sealed Secrets, External Secrets ou Vault

patches:
- patch: |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: nginx-demo
    spec:
      replicas: 3
  target:
    kind: Deployment
    name: nginx-demo
- patch: |-
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: nginx-demo
    spec:
      template:
        spec:
          containers:
          - name: nginx
            resources:
              requests:
                memory: "128Mi"
                cpu: "250m"
              limits:
                memory: "256Mi"
                cpu: "500m"
  target:
    kind: Deployment
    name: nginx-demo
